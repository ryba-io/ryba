{% for hostname, host in hosts %}{% if host.hostgroups %}
{% if host.hostgroups | contains('watcher') %}
define service {
  service_description   Zookeeper Server: Quorum
  host_name             {{ hostname }}
  servicegroups         zookeeper_server
  use                   hadoop-unit-service
  check_command         has_quorum!'Zookeeper Server: TCP'
}
define service {
  service_description   HDFS NN: HA
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         has_one!'HDFS NN: TCP'
}
define service {
  service_description   HDFS NN: Active Node
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_active_nn!50470!-s
}
define service {
  service_description   HDFS JN: Quorum
  host_name             {{ hostname }}
  servicegroups         zookeeper_server
  use                   hadoop-unit-service
  check_command         has_quorum!'HDFS JN: TCP'
}
define service {
  service_description   YARN RM: Active Node
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_active_rm!8090!-s
}
define service {
  service_description   YARN RM: TCP
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_tcp_ha!'YARN RM: Active Node'!8050!1!1
}
define service {
  service_description   YARN RM: Scheduler TCP
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_tcp_ha!'YARN RM: Active Node'!8030!1!1
}
define service {
  service_description   YARN RM: Tracker TCP
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_tcp_ha!'YARN RM: Active Node'!8025!1!1
}
define service {
  service_description   YARN RM: RPC latency
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_rpc_latency_ha!'YARN RM: Active Node'!ResourceManager!8090!3000!5000!-s
}
define service {
  service_description   HBase Master: HA
  host_name             {{ hostname }}
  servicegroups         hbase_master
  use                   hadoop-unit-service
  check_command         has_one!'HBase Master: TCP'
}
{% endif %}
{% if host.hostgroups | contains('zookeeper_server') %}
define service {
  service_description   Zookeeper Server: TCP
  host_name             {{ hostname }}
  servicegroups         zookeeper_server
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.zookeeper.port }}!1!1
}
define service {
  service_description   Zookeeper Server: State
  host_name             {{ hostname }}
  servicegroups         zookeeper_server
  use                   hadoop-unit-service
  check_command         check_socket!{{ host.config.ryba.zookeeper.port }}!ruok!imok
}
define service {
  service_description   Zookeeper Server: Connections
  host_name             {{ hostname }}
  servicegroups         zookeeper_server
  use                   hadoop-unit-service
  check_command         check_zk_stat!{{ host.config.ryba.zookeeper.port }}!connections!300!350
}
{% endif %}
{% if host.hostgroups | contains('zookeeper_server') %}{% endif %}
{% if host.hostgroups | contains('hdfs_nn') %}
define service {
  service_description   HDFS NN: TCP
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_tcp!8020!1!1
}
define service {
  service_description   HDFS NN: RPC latency
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_rpc_latency!NameNode!50470!3000!5000!-s
}
define service {
  service_description   HDFS NN: Last Checkpoint
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_nn_last_checkpoint!50470!21600!1000000!120%!200%!-s
}
define service {
  service_description   HDFS NN: Name Dir status
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_nn_namedirs_status!50470!-s
}
define service {
  service_description   HDFS NN: Utilization
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_hdfs_capacity!50470!80%!90%!-s
}
{### WebHDFS ###}
define service {
  service_description   WebHDFS: WebService
  host_name             {{ hostname }}
  servicegroups         hdfs_nn
  use                   hadoop-unit-service
  check_command         check_webservice!50470!'/webhdfs/v1/?op=GETHOMEDIRECTORY'!'\{"Path":.*'!-s
}
{% endif %}
{### HDFS JN ###}
{% if host.hostgroups | contains('hdfs_jn') %}
define service {
  service_description   HDFS JN: TCP
  host_name             {{ hostname }}
  servicegroups         hdfs_jn
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hdfs.site['dfs.journalnode.https-address'].split(':')[1] }}!1!1
}
{% endif %}
{### HDFS DN ###}
{% if host.hostgroups | contains('hdfs_dn') %}
define service {
  service_description   HDFS DN: TCP
  host_name             {{ hostname }}
  servicegroups         hdfs_dn
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hdfs.site['dfs.datanode.https.address'].split(':')[1] }}!1!1
}
define service {
  service_description   HDFS DN: Available space
  host_name             {{ hostname }}
  servicegroups         hdfs_dn
  use                   hadoop-unit-service
  check_command         check_dn_storage!{{ host.config.ryba.hdfs.site['dfs.datanode.https.address'].split(':')[1] }}!75%!90%!-s
}
{% endif %}
{% if host.hostgroups | contains('zkfc') %}
define service {
  service_description   ZKFC: TCP
  host_name             {{ hostname }}
  servicegroups         zkfc
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hdfs.nn.site['dfs.ha.zkfc.port'] }}!1!1
}
{% endif %}
{% if host.hostgroups | contains('httpfs') %}
define service {
  service_description   HttpFS: WebService
  host_name             {{ hostname }}
  servicegroups         httpfs
  use                   hadoop-unit-service
  check_command         check_webservice!14000!'/webhdfs/v1/?op=GETHOMEDIRECTORY'!'\{"Path":.*'!-s
}
{% endif %}
{% if host.hostgroups | contains('hdfs_client') %}{% endif %}
{### YARN ResourceManager ###}
{% if host.hostgroups | contains('yarn_rm') %}
define service {
  service_description   YARN RM: Admin TCP
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_tcp!8141!1!1
}
define service {
  service_description   YARN RM: WebUI
  host_name             {{ hostname }}
  servicegroups         yarn_rm
  use                   hadoop-unit-service
  check_command         check_webui!8090!-s
}
{% endif %}
{% if host.hostgroups | contains('yarn_nm') %}
define service {
  service_description   YARN NM: TCP
  host_name             {{ hostname }}
  servicegroups         yarn_nm
  use                   hadoop-unit-service
  check_command         check_tcp!45454!1!1
}
define service {
  service_description   YARN NM: WebUI
  host_name             {{ hostname }}
  servicegroups         yarn_nm
  use                   hadoop-unit-service
  check_command         check_webui!8044!-s
}
define service {
  service_description   YARN NM: Health
  host_name             {{ hostname }}
  servicegroups         yarn_nm
  use                   hadoop-unit-service
  check_command         check_webservice!8044!/ws/v1/node/info!'.*"nodeHealthy":true'!-s
}
{% endif %}
{% if host.hostgroups | contains('yarn_ts') %}
define service {
  service_description   YARN TS: TCP
  host_name             {{ hostname }}
  servicegroups         yarn_ts
  use                   hadoop-unit-service
  check_command         check_tcp!10200!1!1
}
define service {
  service_description   YARN TS: WebService
  host_name             {{ hostname }}
  servicegroups         yarn_ts
  use                   hadoop-unit-service
  check_command         check_webservice!8190!'/jmx?qry=Hadoop:service=ApplicationHistoryServer,name=JvmMetrics'!'\{.*"beans" :'!-s
}
{% endif %}
{% if host.hostgroups | contains('yarn_client') %}{% endif %}
{## MapReduce ##}
{% if host.hostgroups | contains('mapred_jhs') %}{% endif %}
{% if host.hostgroups | contains('mapred_client') %}{% endif %}
{% if host.hostgroups | contains('hbase_master') %}
define service {
  service_description   HBase Master: TCP
  host_name             {{ hostname }}
  servicegroups         hbase_master
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hbase.site['hbase.master.port'] }}!1!1
}
define service {
  service_description   HBase Master: WebUI
  host_name             {{ hostname }}
  servicegroups         hbase_master
  use                   hadoop-unit-service
  check_command         check_webui!{{ host.config.ryba.hbase.site['hbase.master.info.port'] }}
}
{% endif %}
{% if host.hostgroups | contains('hbase_regionserver') %}
define service {
  service_description   HBase RegionServer: TCP
  host_name             {{ hostname }}
  servicegroups         hbase_regionserver
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hbase.site['hbase.regionserver.port'] }}!1!1
}
define service {
  service_description   HBase RegionServer: WebUI
  host_name             {{ hostname }}
  servicegroups         hbase_regionserver
  use                   hadoop-unit-service
  check_command         check_webui!{{ host.config.ryba.hbase.site['hbase.regionserver.info.port'] }}!-s
}
{% endif %}
{% if host.hostgroups | contains('hbase_rest') %}
define service {
  service_description   HBase REST: TCP
  host_name             {{ hostname }}
  servicegroups         hbase_rest
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hbase.site['hbase.rest.port'] }}!1!1
}
define service {
  service_description   HBase REST: WebUI
  host_name             {{ hostname }}
  servicegroups         hbase_rest
  use                   hadoop-unit-service
  check_command         check_webui!{{ host.config.ryba.hbase.site['hbase.rest.info.port'] }}
}
{% endif %}
{% if host.hostgroups | contains('hbase_thrift') %}{% endif %}
{% if host.hostgroups | contains('hbase_client') %}{% endif %}
{% if host.hostgroups | contains('hiveserver2') %}
define service {
  service_description   Hiveserver2: TCP
  host_name             {{ hostname }}
  servicegroups         hiveserver2
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hive.site['hive.server2.thrift.port'] }}!1!1
}
{% endif %}
{% if host.hostgroups | contains('hcatalog') %}
define service {
  service_description   Hcatalog: TCP
  host_name             {{ hostname }}
  servicegroups         hcatalog
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.hive.site['hive.metastore.uris'].split(',')[0].split(':')[2] }}!1!1
}
{% endif %}
{% if host.hostgroups | contains('webhcat') %}
define service {
  service_description   WebHCat: WebService
  host_name             {{ hostname }}
  servicegroups         webhcat
  use                   hadoop-unit-service
  check_command         check_webservice!{{ host.config.ryba.webhcat.site['templeton.port'] }}!'/templeton/v1/status'!'\{"status":"ok","version":"v1"\}'
}
{% endif %}
{% if host.hostgroups | contains('oozie_server') %}
define service {
  service_description   Oozie Server: WebUI
  host_name             {{ hostname }}
  servicegroups         oozie_server
  use                   hadoop-unit-service
  check_command         check_webui!{{ host.config.ryba.oozie.http_port }}!-u /oozie -s
}
{% endif %}
{% if host.hostgroups | contains('oozie_client') %}{% endif %}
{% if host.hostgroups | contains('kafka_broker') %}
define service {
  service_description   Kafka Broker: TCP
  host_name             {{ hostname }}
  servicegroups         kafka_broker
  use                   hadoop-unit-service
  check_command         check_tcp!{{ host.config.ryba.kafka.broker.config.port }}!1!1
}
{% endif %}
{### Kafka Producer ###}
{### Kafka Consumer ###}
{## Spark ##}
{### Spark History Server ###}
{### Spark Client ###}
{## Phoenix ##}
{### Phoenix Master ###}
{### Phoenix RegionServer ###}
{### Phoenix Client ###}
{## OpenTSDB ##}
{## Titan DB ##}
{## Tez ##}
{## ElasticSearch ##}
{## SolR ##}
{## Rexster ##}
{## Pig ##}
{## Sqoop ##}
{## Falcon ##}
{## Flume ##}
{% if host.hostgroups | contains('hue') %}
define service {
  service_description   Hue: WebUI
  host_name             {{ hostname }}
  servicegroups         hue
  use                   hadoop-unit-service
  check_command         check_webui!{{ host.config.ryba.hue_docker.ini.desktop.http_port }}!-s
}
{% endif %}
{## Knox ##}
{## Zeppelin ##}
{% endif %}{% endfor %}