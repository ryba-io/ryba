
# Nagios Backup

The backup script dump the content and the logs of Nagios

    module.exports = []
    module.exports.push require('./index').configure    

## Database

    # module.exports.push name: "Nagios # Backup Database", handler: (ctx, next) ->
    #   {nagios} = ctx.config.ryba
    #   username = hive.site['javax.jdo.option.ConnectionUserName']
    #   password = hive.site['javax.jdo.option.ConnectionPassword']
    #   {engine, db, hostname, port} = parse_jdbc hive.site['javax.jdo.option.ConnectionURL']
    #   engines = 
    #     mysql: ->
    #       escape = (text) -> text.replace(/[\\"]/g, "\\$&")
    #       ctx.backup
    #         cmd: """
    #         mysqldump -u{username} -p#{password} -h#{hostname} -P#{port} #{db}
    #         """
    #         destination: '/var/backup/ryba/nagios/'
    #       , next
    #   return next new Error 'Database engine not supported' unless engines[engine]
    #   engines[engine]()

## Logs

Archive the logs generated by Nagios.

    module.exports.push name: "Nagios # Backup Logs", handler: (ctx, next) ->
      {nagios} = ctx.config.ryba
      ctx.backup
        name: 'logs'
        source: nagios.log_dir
        filter: "nagios.log*"
        destination: nagios.backup_dir
        interval: month: 1
        retention: count: 2
      , next

## Configuration

Backup the active Nagios configuration.

    module.exports.push name: "Nagios # Backup Configuration", handler: (ctx, next) ->
      ctx.execute
        name: 'conf'
        source: '/etc/nagios'
        destination: nagios.backup_dir
        interval: month: 1
        retention: count: 2
      , next